# 开发者平台后端
## 工作简述
开发者平台dev.yijianar.com的所有后端接口开发以及deploy。  
可参考  
  https://dev.yijianar.com/open-doc?fileId=820309038  
  https://dev.yijianar.com/open-doc?fileId=240882955  
  https://dev.yijianar.com/open-doc?fileId=370101769  
及其他 OPEN DOC/内部文档/开发者平台的文档

## 模块说明
### 模型处理
全部对接刘超的模型服接口。这边要做的是  
开启任务(start_task),  
重启任务(restart_task),  
回调处理(mserver_callback),  
进度查询(query_tasks),  
取消任务(cancel_task),  
下载模型(download_url_model)
### 智能图像
参考  
https://dev.yijianar.com/open-doc?fileId=082495774  
及其他 OPEN DOC/内部文档/图像算法的文档
### BIM引擎
效果2和效果3需要用到后端，由于模型分别放在autodesk forge和BimFace,查看需要token.   
获取token的方法分别是 autodesk_token 和 bimface_viewtoken  
实践过程参考Autodesk开发和BimFace开发两篇文档  
autodesk forge官方文档: https://aps.autodesk.com/developer/documentation  
BimFace官方文档: https://bimface.com/docs-center
### 360全景图和3D视觉
无需后端
### 空间数据
地图用自启的开源的 map tile server。  
数据为开源的 china2017.mbtiles。  
RTK列表里目前只有5台设备。  
RTK数据采集可参考 https://dev.yijianar.com/open-doc?fileId=328720040  
页面根据设备的gps点位集合生成轨迹。
### OPEN DOC
实现说明可参考 https://dev.yijianar.com/open-doc?fileId=885985264   
部分接口后续有更新，接口部分以《自动化测试接口》文档为准
### OPEN DATA
主要实现模型、视频、图片等的OSS存储与访问。
### ChatGPT
调用OpenAI公司的chatgpt接口，模型用的gpt-3.5-turbo。  

## 代码文件
参考yjopenapi工程  
http://192.168.50.77/guozheng/yjopenapi  

## 其他依赖项或说明
主要模块的工作基本都能在OPEN DOC里个人署名的文档里找到。

# AIServer架构
参考文档 https://dev.yijianar.com/open-doc?fileId=082495774  
工程代码位于 http://192.168.50.77/guozheng/gpuservice

# 嵌入式开发
## RTK盒子
主要把原先多线程版本简化为单线程版本，再增加航向角、数据筛选滤波、网络穿透等功能以及UI的更新。此外解决一些网络问题和开机自启问题等。  
工程代码位于 http://192.168.50.77/guozheng/raspberry_rtk  
实践文档参考 https://dev.yijianar.com/open-doc?fileId=328720040

## 采集设备
主要实现ROS系统下的UI和事件触发机制以及开机自启等功能。  
代码在采集设备里。

# 补充说明
## 部署脚本
yjopenapi工程的脚本位置: yjopenapi/run-developer.sh  
gpuservice工程的脚本位置: gpuservice/run.sh  
运行方法为 ./run.sh

## 框架问题
python 3.10
### yjopenapi  
```
aiohttp
aiohttp_cors
aiohttp-tokenauth
aiortc
aiomysql
redis
requests
opencv-python
xlrd
markdown
oss2
dingtalk-sdk
aliyun-python-sdk-sts
```
### gpuservice
```
flask
flask_cors
oss2
opencv-python
redis
rq
pynvml
torch
torchvision
```

## 注释与文档
### yjopenapi
account.py, 账号相关， https://dev.yijianar.com/open-doc?fileId=240882955  
aigc.py, chatgpt接口, https://openai.com/blog/introducing-chatgpt-and-whisper-apis  
app.py, 主程，定义路由等  
apprun.py, 启动入口  
authority.py 权限相关, https://dev.yijianar.com/open-doc?fileId=240882955  
callback.py 钉钉和微信的回调接口  
config.py 环境变量和全局参数  
d3viewer.py autodesk forge 和 BimFace token相关，https://dev.yijianar.com/open-doc?fileId=632600429，https://dev.yijianar.com/open-doc?fileId=774359161  
md.py OPENDOC的文档相关， https://dev.yijianar.com/open-doc?fileId=885985264  
modeltask.py, 模型处理接口， https://dev.yijianar.com/open-doc?fileId=461918371，https://dev.yijianar.com/open-doc?fileId=240882955  
opendata.py, OPENDATA相关  
space3d.py, 空间数据, https://dev.yijianar.com/open-doc?fileId=328720040, https://dev.yijianar.com/open-doc?fileId=228139714  
toolfunc.py, 工具函数
### gpuservice
heartbeat.py, 调度服需要的心跳接口
detection.py, 图像视频检测接口  
dispatch.py, 与调度服对接接口, 文档参考 http://192.168.50.202/apis/mserver#%E5%A4%96%E9%83%A8%E4%B8%9A%E5%8A%A1%E6%9C%8D   
ocr.py, 开发者平台的ocr接口  
stream.py, 视频流查看相关接口  
video_monitor.py, 监测相关  
cad_ocr目录，修改调用paddle ocr  
ocr_images, ocr结果图  
ocr_txts, ocr结果文字  
segmentation目录，语义分割  
### rtsp-yolo
http://192.168.50.77/Niecong/rtsp-yolo  
rtsp流的检测，如果测试没问题，可以封装成接口

