# 下载图片并保存成文件
The reqwest crate allows us to create HTTP requests with ease, we can combine functionality provided by the create with the fs and io modules from Rusts standard library to solve this trivia. We also use the anyhow crate, to streamline error handling.  

## Blocking implemenation
```shell
cargo add anyhow
cargo add reqwest -F blocking
```

```rust
use std::{fs::File, io::copy};
use anyhow::Result;

fn download_image(url: &str, file_name: &str) -> Result<()> {
    let mut response = reqwest::blocking::get(url)?;
    let mut file = File::create(file_name)?;
    copy(&mut response, &mut file)?;
    Ok(())
}

fn main() {
    let image_url = "https://www.rust-lang.org/static/images/rust-logo-blk.svg";
    let file_name = "rust-logo-blk.svg";
    match download_image(image_url, file_name) {
        Ok(_) => println!("image saved successfully"),
        Err(e) => println!("error while downloading image: {}", e),
    }
}
```

## Non-blocking (async) implementation
```shell
cargo add anyhow
cargo add reqwest -F blocking
cargo add tokio -F full
```

```rust
use std::{fs::File, io::{copy, Cursor}};
use anyhow::Result;

async fn download_image_to(url: &str, file_name: &str) -> Result<()> {
    let response = reqwest::get(url).await?;
    let mut file = File::create(file_name)?;
    
    // Create a cursor that wraps the response body
    let mut content =  Cursor::new(response.bytes().await?);
    copy(&mut content, &mut file)?;

    Ok(())
}

#[tokio::main]
async fn main() -> Result<()> {
    let image_url = "https://www.rust-lang.org/static/images/rust-logo-blk.svg";
    let file_name = "rust-logo-blk.svg";
    match download_image_to(image_url, file_name).await {
        Ok(_) => println!("image saved successfully"),
        Err(e) => println!("error while downloading image: {}", e),
    }
    Ok(())
}
```

## Comments
You async example is actually doing a blocking file write and requires you to load the whole image into memory before writing it to a file.

A better way to do that would be to have reqwest give you a byte stream and write to the file with Tokio's async IO library as shown in this stack overflow answer: https://stackoverflow.com/a/74283625