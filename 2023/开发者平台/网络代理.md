开发人员经常遇到的网络问题:  
1. 不能访问国外网络  
2. 不能登录某个局域网内的服务器或者用运营商卡上网的终端  
3. 不能访问某个局域网内的(WEB)服务  
4. 对外IP改变带来的问题  

1和2的解决方案，我们已经记录在《Trojan科学上网》，本文给出3和4的解决办法。
# 正向代理和反向代理
正向代理作为client和server的中间人，扮演着流量接力的作用。也就是，一个请求要到达目的地服务器(host server)，需要经过一个中间服务器，即代理服务器(proxy server)。这时host server只能看到proxy server的IP。  
反向代理则通常坐落在多个服务器的前面。请求到达proxy server后，由它路由到某个目的地服务器。  
正向代理和反向代理的区别可以简单理解为目的地服务器是一台还是多台。这里讲的流量转发属于正向代理。  
这里给出Nginx的配置，Nginx是最受欢迎的web服务器，经常被用来作负载均衡、反向代理和HTTP Cache.
```shell
server {
    listen 8999;
    location / {
        proxy_pass http://192.168.50.212:15002;
    }
}
```

# Linux Proxy Server
很多时候，由于对外IP经常变动等种种原因，我们需要通过一台代理服务器上网，有时也称改IP上网。  
之前用于翻墙的Trojan就是一种典型的代理服务器。今天我们用另一种服务-Dante, 来提供SOCKS5代理。  
```shell
sudo apt update
sudo apt install dante-server
sudo systemctl status danted  # failed
sudo vim /etc/danted.conf 
```  
```
logoutput: syslog
user.privileged: root
user.unprivileged: nobody

internal: 0.0.0.0 port=8111

external: eth0

socksmethod: username

clientmethod: none

client pass {
    from: 0.0.0.0/0 to: 0.0.0.0/0
}

socks pass {
    from: 0.0.0.0/0 to: 0.0.0.0/0
}
```
设置连接用的登录账户
```shell
sudo useradd -r -s /bin/false danteuser
sudo passwd danteuser
```
```shell
sudo systemctl restart danted
```
## 客户端连接
先用代理测试HTTP请求
```shell
curl -v -x socks5://danteuser:******@47.117.136.225:8111 https://dev.yijianar.com/api/helloworld
```
一般启动程序我们得用Terminal用命令行启动，这时最好安装proxychains比较方便
```shell
sudo apt install proxychains-ng
sudo vim /etc/proxychains4.conf
    socks5  47.102.145.41 8111
```
这样凡是用proxychains4打头的命令，都实现了改IP。
```shell
proxychains4 curl ifconfig.me  
# 47.102.145.41
```
